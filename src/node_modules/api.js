const api = {}

api.getProfile = () => new Promise((resolve, reject) => {
  const xmlhttp = new XMLHttpRequest();

  xmlhttp.open('GET', '/api/auth/profile', true);

  xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState === 4) {
      if (xmlhttp.status === 200) {
        const response = JSON.parse(xmlhttp.responseText)
        return response.status === "OK" ? resolve(response.message) : reject("Not Auth");
      } else {
        return reject("Not Auth");
      }
    }
  };

  xmlhttp.send();
});

api.login = credentials => new Promise((resolve, reject) => {
  const email = credentials.email;
  const password = credentials.password;
  const xmlhttp = new XMLHttpRequest();
  window.xmlhttp = xmlhttp;
  xmlhttp.open('POST', '/api/auth/login', true);
  xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

  xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState === 4) {
      api.getProfile()
        .then(profile => resolve(profile))
        .catch(error => reject(error));
      }
  };

  xmlhttp.send(`email=${email}&password=${password}&remember=on`);
});

export default api