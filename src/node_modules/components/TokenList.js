import React from 'react';

export default class TokenList extends React.Component {
  render() {
    const { tokens, submit, pattern } = this.props;

    return (
      <div>
        {tokens.map(token => <Token key={token.id} token={token} submit={submit} pattern={pattern} />)}
      </div>
    );
  };
};

class Token extends React.Component {
  backgroundPattern(str, pattern) {
    if (str.toLowerCase().indexOf(pattern) === -1) {
      return <span>{str}</span>;
    } else {
      return (
        <span>
          {str.slice(0, str.toLowerCase().indexOf(pattern))}
          <span className='token-component__yellow'>
            {str.slice(str.toLowerCase().indexOf(pattern), str.toLowerCase().indexOf(pattern) + pattern.length)}
          </span>
          {str.slice(str.toLowerCase().indexOf(pattern) + pattern.length)}
        </span>
      );
    }
  }

  renderStudio(token) {
    if (token.studio) {
      return <span>{this.backgroundPattern(token.studio.name, this.props.pattern)} ({token.studio.language})</span>;
    } else {
      return <span>{token.serial.language}</span>;
    }
  }

  render() {
    const { token, submit, pattern } = this.props;

    let style = 'large-6 large-centered columns token-component ';
    style += token.subscribed ? 'token-component__subscribed' : 'token-component__unsubscribed';

    return (
      <div className={style}>
        <div className='token-component__right'>
          {this.backgroundPattern(token.serial.title, pattern)}
          <div className='token-component__studio' >{this.renderStudio(token)}</div>
        </div>
        <div className='token-component__left'>
          <span type='button' className='token-component__button' onClick={() => submit(token.id)}>{token.subscribed ? 'unsubscribe' : 'subscribe'}</span>
        </div>
      </div>
    );
  };
};
